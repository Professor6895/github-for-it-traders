(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"7AVf":function(e,a,t){"use strict";t.r(a);var n=t("o0o1"),r=t.n(n),i=t("w48C"),s=t.n(i),o=(t("CVKz"),t("uBql")),c=t("LvDl"),l=t.n(c),d=t("t2rG"),u=t.n(d);function m(e,a,t,n,r,i,s){try{var o=e[i](s),c=o.value}catch(e){return void t(e)}o.done?a(c):Promise.resolve(c).then(n,r)}function v(e){return function(){var a=this,t=arguments;return new Promise((function(n,r){var i=e.apply(a,t);function s(e){m(i,n,r,s,o,"next",e)}function o(e){m(i,n,r,s,o,"throw",e)}s(void 0)}))}}var g={props:["bannerid"],data:function(){return{loading:!0,imagePopup:!1,banner_images:[],bannerimage:{},image_preview:null}},components:{flatPickr:s.a,draggable:u.a},mounted:function(){this.fetchBannerImages()},methods:{fetchBannerImages:function(){var e=this;return v(r.a.mark((function a(){var t;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.next=4,e.$http.get("/api/admin/banner/".concat(e.bannerid,"/images"));case 4:t=a.sent,e.banner_images=t.data.data,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),e.errorNotification("Something went wrong!! Please retry");case 11:return a.prev=11,e.loading=!1,a.finish(11);case 14:case"end":return a.stop()}}),a,null,[[1,8,11,14]])})))()},saveBannerImage:function(){var e=this;return v(r.a.mark((function a(){var t,n,i,s;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$validator.validateAll();case 2:if(a.sent){a.next=5;break}return a.abrupt("return");case 5:return a.prev=5,e.$vs.loading({container:"#banner-image--container"}),t={image:e.bannerimage.image,link:e.bannerimage.link,start_date:e.bannerimage.start_date,end_date:e.bannerimage.end_date,content:e.bannerimage.content},n="/api/admin/banner/".concat(e.bannerid,"/images"),e.bannerimage.id&&(n="/api/admin/banner/".concat(e.bannerid,"/images/").concat(e.bannerimage.id),t._method="PATCH"),i=Object(o.a)(t),a.next=13,e.$http.post(n,i);case 13:s=a.sent,e.successNotification(s.data.message),e.imagePopup=!1,e.fetchBannerImages(),a.next=23;break;case 19:a.prev=19,a.t0=a.catch(5),Object(o.e)(e.errors,a.t0),e.errorNotification("Something went wrong! Please retry!!");case 23:return a.prev=23,e.$vs.loading.close("#banner-image--container > .con-vs-loading"),a.finish(23);case 26:case"end":return a.stop()}}),a,null,[[5,19,23,26]])})))()},editImage:function(e){this.bannerimage=l.a.cloneDeep(e),this.image_preview=this.bannerimage.banner_image.thumb,this.imagePopup=!0},imageUploaded:function(){var e=this.$refs.banner_image.files[0];this.image_preview=URL.createObjectURL(e),this.bannerimage.image=e},clearImage:function(){this.bannerimage.image=null,this.image_preview=null,this.$refs.banner_image.value=""},deleteBannerImage:function(e){var a,t=this;this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",text:"Are you sure you want to delete banner image?",accept:(a=v(r.a.mark((function a(){var n;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$http.delete("/api/admin/banner/".concat(t.bannerid,"/images/").concat(e));case 2:(n=a.sent).data.success?(t.successNotification(n.data.message),t.fetchBannerImages()):t.errorNotification(n.data.message);case 4:case"end":return a.stop()}}),a)}))),function(){return a.apply(this,arguments)})})},sortImages:function(){var e=this;return v(r.a.mark((function a(){var t,n;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e.$vs.loading({container:"#images-loading--container"}),t=[],e.banner_images.map((function(e,a){t.push({image_id:e.id,order:a+1})})),a.next=6,e.$http.post("/api/admin/banner/".concat(e.bannerid,"/images/sort-images"),{payload:t});case 6:(n=a.sent).data.success&&e.successNotification(n.data.message),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),console.log(a.t0);case 13:return a.prev=13,e.$vs.loading.close("#images-loading--container > .con-vs-loading"),a.finish(13);case 16:case"end":return a.stop()}}),a,null,[[0,10,13,16]])})))()}},watch:{imagePopup:function(e){e||(this.image_preview=null,this.bannerimage={},this.errors.clear())}}},p=t("KHd+");function f(e,a,t,n,r,i,s){try{var o=e[i](s),c=o.value}catch(e){return void t(e)}o.done?a(c):Promise.resolve(c).then(n,r)}function b(e){return function(){var a=this,t=arguments;return new Promise((function(n,r){var i=e.apply(a,t);function s(e){f(i,n,r,s,o,"next",e)}function o(e){f(i,n,r,s,o,"throw",e)}s(void 0)}))}}var _={data:function(){return{id:null,banner:{}}},components:{BannerImages:Object(p.a)(g,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[e.loading?t("pageLoader"):t("vx-card",{staticClass:"card-padding-5 vs-con-loading__container",attrs:{title:"Banner Images",id:"images-loading--container"}},[t("vs-table",{attrs:{search:"",stripe:"",data:e.banner_images,"max-items":"40",pagination:""},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.data;return[t("draggable",{attrs:{tag:"tbody"},on:{change:e.sortImages},model:{value:e.banner_images,callback:function(a){e.banner_images=a},expression:"banner_images"}},e._l(n,(function(a){return t("tr",{key:a.id,staticClass:"tr-values"},[t("vs-td",[t("img",{attrs:{src:a.banner_image.thumb,alt:"",width:"120px"}})]),e._v(" "),t("vs-td",[a.start_date?t("small",[e._v(e._s(e._f("date_format")(a.start_date,"MMMM Do YYYY")))]):t("small",[e._v("----")])]),e._v(" "),t("vs-td",[a.end_date?t("small",[e._v(e._s(e._f("date_format")(a.end_date,"MMMM Do YYYY")))]):t("small",[e._v("----")])]),e._v(" "),t("vs-td",[t("vs-button",{staticClass:"table-action--buttons",attrs:{radius:"",color:"warning",type:"filled",icon:"create"},on:{click:function(t){return e.editImage(a)}}}),e._v(" "),t("vs-button",{staticClass:"table-action--buttons",attrs:{radius:"",color:"danger",type:"filled",icon:"delete"},on:{click:function(t){return e.deleteBannerImage(a.id)}}})],1)],1)})),0)]}}])},[t("template",{slot:"header"},[t("strong",[e._v("Total :")]),e._v("\n         "+e._s(e.banner_images.length)+"    \n        "),t("vs-button",{attrs:{color:"primary",size:"small",type:"border"},on:{click:function(a){e.imagePopup=!0}}},[e._v("Add Image")])],1),e._v(" "),t("template",{slot:"thead"},[t("vs-th",[e._v("Image")]),e._v(" "),t("vs-th",{attrs:{"sort-key":"start_date"}},[e._v("Visible from")]),e._v(" "),t("vs-th",{attrs:{"sort-key":"end_date"}},[e._v("Visible to")]),e._v(" "),t("vs-th",[e._v("Actions")])],1)],2)],1),e._v(" "),t("vs-popup",{staticClass:"popup-lg",attrs:{title:"Banner Image",active:e.imagePopup},on:{"update:active":function(a){e.imagePopup=a}}},[t("form",{staticClass:"vs-con-loading__container",attrs:{id:"banner-image--container"}},[t("div",{staticClass:"vx-row"},[t("div",{staticClass:"vx-col w-full"},[e.image_preview?t("div",{staticClass:"image-preview-container mt-4"},[t("div",{staticClass:"text-right float-right mr-10"},[t("vs-button",{staticClass:"image-remove--button",attrs:{radius:"",size:"small",color:"danger",type:"filled","icon-pack":"feather",icon:"icon-x"},on:{click:e.clearImage}})],1),e._v(" "),t("img",{attrs:{src:e.image_preview,alt:""}})]):e._e(),e._v(" "),t("input",{directives:[{name:"validate",rawName:"v-validate",value:"image|size:2048",expression:"'image|size:2048'"}],ref:"banner_image",staticClass:"hidden",attrs:{type:"file",name:"image",accept:"image/*"},on:{change:e.imageUploaded}}),e._v(" "),t("p",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("image"),expression:"errors.has('image')"}],staticClass:"text-danger text-sm mb-3"},[e._v(e._s(e.errors.first("image")))]),e._v(" "),t("vs-button",{attrs:{color:"primary",type:"border",size:"small"},on:{click:function(a){return e.$refs.banner_image.click()}}},[e._v("Upload Image")])],1),e._v(" "),t("div",{staticClass:"vx-col w-full"},[t("vs-input",{staticClass:"w-full mt-4",attrs:{name:"link",label:"Banner Link"},model:{value:e.bannerimage.link,callback:function(a){e.$set(e.bannerimage,"link",a)},expression:"bannerimage.link"}}),e._v(" "),e.errors.has("link")?t("span",{staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("link")))]):e._e()],1),e._v(" "),t("div",{staticClass:"vx-col w-1/2 mt-4"},[t("label",{attrs:{for:""}},[e._v("Visible from")]),e._v(" "),t("flat-pickr",{staticClass:"w-full",attrs:{config:{dateFormat:"Y-m-d"},name:"start_date"},model:{value:e.bannerimage.start_date,callback:function(a){e.$set(e.bannerimage,"start_date",a)},expression:"bannerimage.start_date"}})],1),e._v(" "),t("div",{staticClass:"vx-col w-1/2 mt-4"},[t("label",{attrs:{for:""}},[e._v("Visible to")]),e._v(" "),t("flat-pickr",{staticClass:"w-full",attrs:{config:{dateFormat:"Y-m-d"},name:"end_date"},model:{value:e.bannerimage.end_date,callback:function(a){e.$set(e.bannerimage,"end_date",a)},expression:"bannerimage.end_date"}})],1),e._v(" "),t("div",{staticClass:"vx-col w-full mt-4"},[t("label",{attrs:{for:""}},[e._v("Content")]),e._v(" "),t("q-editor",{model:{value:e.bannerimage.content,callback:function(a){e.$set(e.bannerimage,"content",a)},expression:"bannerimage.content"}})],1)]),e._v(" "),t("div",{staticClass:"flex justify-between flex-row-reverse"},[t("vs-button",{staticClass:"mt-4 float-right",attrs:{type:"border"},on:{click:e.saveBannerImage}},[e._v("Save")])],1)])])],1)}),[],!1,null,null,null).exports},mounted:function(){this.id=this.$route.params.id,this.fetchBanner()},methods:{fetchBanner:function(){var e=this;return b(r.a.mark((function a(){var t;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.id){a.next=2;break}return a.abrupt("return");case 2:return e.$vs.loading({container:"#loading--container"}),a.prev=3,a.next=6,e.$http.get("/api/admin/banners/".concat(e.id));case 6:(t=a.sent).data.success&&(e.banner=t.data.data),a.next=15;break;case 10:if(a.prev=10,a.t0=a.catch(3),e.errorNotification("Something went wrong! Please disable you adblocker if it is turned on and retry!!"),404!==a.t0.response.status){a.next=15;break}return a.abrupt("return",e.$router.push({name:"page-error-404"}));case 15:return a.prev=15,e.$vs.loading.close("#loading--container > .con-vs-loading"),a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[3,10,15,18]])})))()},saveBanner:function(){var e=this;return b(r.a.mark((function a(){var t,n,i;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$validator.validateAll();case 2:if(a.sent){a.next=5;break}return a.abrupt("return");case 5:return a.prev=5,e.$vs.loading({container:"#loading--container"}),t={name:e.banner.name},n="/api/admin/banners",e.id&&(n="/api/admin/banners/".concat(e.id),t._method="PATCH"),a.next=12,e.$http.post(n,t);case 12:if(!0!==(i=a.sent).data.success){a.next=22;break}if(e.successNotification(i.data.message),e.id){a.next=19;break}return a.abrupt("return",e.$router.push({name:"admin-banner-detail",params:{id:i.data.banner.id}}));case 19:e.fetchBanner();case 20:a.next=23;break;case 22:e.errorNotification(i.data.message);case 23:a.next=28;break;case 25:a.prev=25,a.t0=a.catch(5),e.errorNotification("Something went wrong! Please retry!!");case 28:return a.prev=28,e.$vs.loading.close("#loading--container > .con-vs-loading"),a.finish(28);case 31:case"end":return a.stop()}}),a,null,[[5,25,28,31]])})))()},deleteBanner:function(){var e,a=this;this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",text:"Are you sure you want to delete banner?",accept:(e=b(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.$http.delete("/api/admin/banners/".concat(a.id));case 2:if(!(t=e.sent).data.success){e.next=8;break}return a.successNotification(t.data.message),e.abrupt("return",a.$router.push({name:"admin-banners"}));case 8:a.errorNotification(t.data.message);case 9:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})}}},h=Object(p.a)(_,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("vx-card",{staticClass:"md:w-2/3 w-full vs-con-loading__container",attrs:{id:"loading--container"}},[t("div",{staticClass:"vx-row"},[t("div",{staticClass:"vx-col w-full mb-4"},[t("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{name:"name",label:"Name"},model:{value:e.banner.name,callback:function(a){e.$set(e.banner,"name",a)},expression:"banner.name"}}),e._v(" "),e.errors.has("name")?t("span",{staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("name")))]):e._e()],1)]),e._v(" "),t("div",{staticClass:"flex justify-between flex-row-reverse"},[t("vs-button",{staticClass:"mt-4 float-right",attrs:{size:"small",type:"border"},on:{click:e.saveBanner}},[e._v("Save")]),e._v(" "),e.id&&e.checkPermission("delete-banner")?t("vs-button",{staticClass:"mt-4 float-right",attrs:{size:"small",color:"danger"},on:{click:e.deleteBanner}},[e._v("Delete")]):e._e()],1)]),e._v(" "),e.id&&e.checkPermission("manage-banner-images")?t("div",{staticClass:"vx-col md:w-2/3 w-full mt-5"},[t("BannerImages",{attrs:{bannerid:e.id}})],1):e._e()],1)}),[],!1,null,null,null);a.default=h.exports}}]);